## 1. 概要

本ドキュメントは、ローカルネットワークでの対戦が可能なタイピング練習ゲームの要件を定義するものである。

- **プロジェクト目的**: 楽しみながらタイピングスキルを向上させること。特に、友人や同僚とローカル環境で気軽に対戦できる機能を提供する。
- **ターゲットユーザー**:
    - タイピング初心者から中級者
    - 友人や家族とオフラインでゲームを楽しみたいユーザー

## 2. システム要件

- **動作環境**: Windows 10, Windows 11
- **配布形式**: ZIPファイル（インストール不要で実行可能）
- **最小解像度**: 1280 x 800
- **その他**: オフラインで全ての機能が動作すること。

## 3. 機能要件

### 3.1. 全体フロー

1. **アプリ起動**: アプリケーションを起動する。
2. **ユーザー選択**: 既存のユーザープロファイルを選択するか、新規作成する。
3. **メインメニュー**: 以下のメニューが表示される。
    - **ゲームスタート**: ステージ選択画面へ遷移する。
    - **統計データ**: 自身の成績確認画面へ遷移する。
    - **設定**: 各種設定画面へ遷移する。
    - **終了**: アプリケーションを終了する。

### 3.2. ユーザープロファイル機能

- **作成**: 新しいユーザー名でプロファイルを作成する。
- **選択**: 起動時に既存のプロファイルリストから選択する。
- **変更**: ユーザー名の変更が可能。
- **削除**: プロファイルを削除できる。削除時には確認ダイアログを表示する。

### 3.3. ゲームモード（ステージ）詳細

全9ステージ構成。各ステージのクリアデータはユーザープロファイルに紐づけて保存される。

| ステージ番号 | ステージ名 | 課題 | UI表示 | 備考 |
| --- | --- | --- | --- | --- |
| **1** | ホームキー・ならし | ホームキーポジションのランダムな1文字 | キーレイアウト表示 | 基本の練習 / **制限時間90秒** |
| **2** | 全キー・ならし | 全てのキーのランダムな1文字 | キーレイアウト表示 | **制限時間90秒** |
| **3** | 星降るホームキー | ホームキーポジションのランダムな文字列 | **キーレイアウト非表示** | 80文字クリアで終了 / 残り時間はボーナススコア / 制限時間120秒 / **ゲーム仕様は下記参照** |
| **4** | 星降る全キー | 全てのキーのランダムな文字列 | **キーレイアウト非表示** | 80文字クリアで終了 / 残り時間はボーナススコア / 制限時間120秒 / **ゲーム仕様は下記参照** |
| **5** | 単語れんしゅう | 一般的な単語 |  |  |
| **6** | 文章れんしゅう | 短めの文章 |  |  |
| **7** | 対戦：進捗レース | 文章 | 相手の進捗バーを表示 | 先に文章を打ち終えた方の勝利 |
| **8** | 対戦：早食いチャレンジ | ランダムな単語（料理に見立てる） | 制限時間、相手のスコアを表示 | 制限時間内に多くの単語をタイピングし、スコアが高い方の勝利 |
| **9** | 苦手キー復習 | 統計データから判定された苦手キーを重点的に出題 |  | 苦手キーがない場合はランダムに出題 |

**※ステージ3, 4の共通ゲーム仕様:**

- **演出**: 文字が書かれた星が画面上部から降ってくる。
- **文字数増加**: 5文字正解するごとに、一度に表示される文字数が1文字追加される（最大10文字まで）。
- **ペナルティ**: 1回ミスタイプするごとに、残り時間が減少する（例: -1秒）。

### 3.4. ネットワーク対戦機能 (ステージ7, 8)

- **方式**: ホスト＆クライアント方式
- **最大人数**: 2名
- **接続フロー**: (省略)
- **接続エラー時の処理**:
    - 対戦中にネットワーク接続が切断された場合、最大10秒間、自動での再接続を試みる。
    - 10秒以内に再接続できなかった場合、接続が維持されている側のプレイヤーを勝利とし、ゲームを終了する。

### 3.5. スコアリングと評価

- **基本スコア計算式**: `基本スコア = KPM (1分間あたりのキー入力数) × 正確率 (%)`
- **KPM (Keys Per Minute)**: `(総タイプ数 / 所要時間(秒)) * 60`
- **正確率 (Accuracy)**: `(正しいタイプ数 / 総タイプ数) * 100`
- **ボーナススコア (ステージ3, 4のみ)**:
    - 80文字を打ち終えた時点の残り時間がボーナススコアとして加算される。
    - **計算式**: `最終スコア = 基本スコア + (残り時間(秒) × 100)` ※係数100は仮
- **ミスタイプの扱い**:
    - **全ステージ共通**: 正しいキーが入力されるまで先に進めない。
    - **ステージ3, 4のみ**: 上記に加え、ミスタイプ時に残り時間が減少するペナルティが発生する。

### 3.6. 統計・分析機能

- **ステージ毎のスコアグラフ**:
    - 各ステージの過去のスコア履歴を折れ線グラフで表示し、上達度を可視化する。
- **苦手キー分析**:
    - キーごとの「ミスタイピング率」と「平均反応速度」を一覧で表示する。
    - ミスタイピング率が高いキーを「苦手キー」としてハイライト表示する。

### 3.7. データ管理

- **課題文データ**: `questions.json` (省略)
- **キーボードレイアウトデータ**: `layouts.json` (省略)
- **言語データ**: `lang_ja.json`, `lang_en.json` (省略)

### 3.8. UI/画面仕様

- **結果表示画面**:
    - ゲーム終了後、以下の項目を表示する。
        - **スコア**: 今回獲得した最終スコア。
        - **ボーナス**: 残り時間によるボーナススコア（対象ステージのみ）。
        - **KPM**: 1分間あたりのキー入力数。
        - **正答率**: 正しい入力の割合。
        - **自己ベスト比較**: 今回のスコアと、これまでの自己ベストスコアを並べて表示する。更新した場合は「New Record!」などの演出を表示。
    - 過去のスコア推移を折れ線グラフで表示し、今回の結果がグラフ上のどこに位置するかを示す。
- **設定画面**:
    - メインメニューの「設定」から遷移する。
    - 以下の項目を変更できる。
        - **表示言語**: `lang_xx.json` に基づく言語リストから選択。
        - **キーボードレイアウト**: `layouts.json` に基づくレイアウトリストから選択。
        - **サウンド設定**: BGM、効果音の音量調整およびON/OFF。

### 3.9. エラーハンドリング

- **ファイルI/Oエラー**: `questions.json` 等のデータファイルが破損、または見つからない場合、「設定ファイルが読み込めません。」というエラーメッセージを表示してアプリケーションを終了する。
- **ユーザープロファイルエラー**: 既に存在する名前でユーザープロファイルを作成しようとした場合、「その名前は既に使用されています。」というエラーメッセージを表示する。
- **ネットワーク接続エラー**: クライアントがホストのIPアドレスを間違えて入力した場合、「ホストが見つかりませんでした。IPアドレスを確認してください。」というエラーメッセージを表示する。

### 3.10. データ保存仕様

- **保存場所**: アプリケーションの実行ファイルと同じ階層に`save_data`フォルダを作成し、その中に全てのユーザーデータを保存する。これにより、USBメモリ等での持ち運びが可能になる。
- **保存形式**: ユーザープロファイルごとに個別のJSONファイルとして保存する（例: `Taro.json`, `Hanako.json`）。ファイルには、ユーザー名、各ステージのハイスコア、統計データなどが含まれる。

## 4. 非機能要件

### 4.1. UI/UXデザイン

- **デザインテーマ**: 「ゆるふわ」 (省略)
- **フォント**: アプリケーションにフォントファイルは同梱せず、OSに標準でインストールされているフォント（例: メイリオ, 游ゴシックなど）を使用する。これにより、配布ファイルのサイズを軽量に保つ。
- **サウンド**: (省略)

### 4.2. パフォーマンス

- 入力の遅延（ラグ）が発生しないよう、快適なタイピング体験を保証する。
- 低スペックのPCでも、最小要件を満たしていればスムーズに動作すること。